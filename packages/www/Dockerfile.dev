FROM node:12 AS builder

RUN apt-get update
RUN apt-get install -y jq

WORKDIR /app
COPY package.json yarn.lock ./
RUN yarn --frozen-lockfile
COPY . .
RUN yarn build
RUN jq 'del(.devDependencies)' package.json > tmp.json && mv tmp.json package.json
RUN yarn --frozen-lockfile

ENTRYPOINT [ "yarn", "start" ]
