dev:
  command: |
    go build
    npx concurrently \
      'ZHQUIZ_DESKTOP=0 ./zhquiz'\
      'cd _packages/next-web && pnpm dev'
dist-web:
  command: |
    mkdir -p ./public
    cd _packages/nuxt
    cp -rv ./dist/* ../../public
dist-windows:
  command: |
    if [ "$DIST_MAIN" != "0" ]; then
      robo -c {{ .robo.file }} dist-web
    fi

    $(go env GOPATH)/bin/xgo \
      -ldflags="-H windowsgui" \
      -branch={{.branch}} \
      -targets=windows/* \
      {{.repo}}

    if [ "$DIST_MAIN" != "0" ]; then
      robo -c {{ .robo.file }} pack
    fi
dist-mac-linux:
  command: |
    if [ "$DIST_MAIN" != "0" ]; then
      robo -c {{ .robo.file }} dist-web
    fi

    $(go env GOPATH)/bin/xgo \
      -branch={{.branch}} \
      -targets=darwin/amd64,linux/386,linux/amd64 \
      {{.repo}}

    if [ "$DIST_MAIN" != "0" ]; then
      robo -c {{ .robo.file }} pack
    fi
dist:
  summary: |
    Build for Linux, Windows, and macOS
    Install `xgo` using `go get github.com/karalabe/xgo`
  command: |
    robo -c {{ .robo.file }} dist-web

    export DIST_MAIN=0

    robo -c {{ .robo.file }} dist-windows
    robo -c {{ .robo.file }} dist-mac-linux

    robo -c {{ .robo.file }} pack
pack:
  command: |
    go run ./_scripts/pack
desktop:
  command: |
    ./zhquiz
start:
  command: |
    ZHQUIZ_DESKTOP=0 ./zhquiz

##########
# Settings

variables:
  repo: github.com/patarapolw/zhquiz
  branch: $(git branch --show-current)
